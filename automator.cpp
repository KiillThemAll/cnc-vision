#include "automator.h"
#include <math.h>

Automator::Automator(QObject *parent) : QObject(parent)
{
    m_working = false;
    m_enabled = false;
    m_mcConnected = false;
    m_cameraConnected = false;
    m_lastdzValid = false;
    m_lastCoordsValid = false;
    m_message = "Waiting for pause";
    m_cutModeEnabled = false;
    m_autosendPower = false;
    m_minPower = 1.0;
    m_maxPower = 0.8;
    m_lastSentPower = 0.0;
    m_powerTimer.setInterval(1000); // maximum power update rate [ms]
    m_powerTimer.setSingleShot(true);

    m_mcs_x_check_state = 0;
    m_mcs_y_check_state = 0;
    m_compensatorOneShot = false;
    m_scanOneShot = false;

    m_surfaceModel = new SurfaceModel(this);

    m_state = Disabled;

    m_scanComplited = false;

    m_surfaceSpline = nullptr;
}

Automator::~Automator()
{
    delete m_surfaceSpline;
}

bool Automator::working() const
{
    return m_working;
}

void Automator::ondzChanged(float dz)
{
    m_lastdz = dz;
}

void Automator::ondzValidChanged(bool valid)
{
    m_lastdzValid = valid;
    m_cameraConnected = valid;
    checkWorkingState();
}

void Automator::onMcConnectionStateChanged(bool connected)
{
    m_mcConnected = connected;
    checkWorkingState();
}

void Automator::onRayConnectionStateChanged(bool connected)
{
    m_lastCoordsValid = connected;
}

void Automator::onCoordsChanged(float x, float y, float z, float b)
{
    Q_UNUSED(z);
    m_mcs_x = x;
    m_mcs_y = y;
    m_mcs_b = b;

    if (!m_autosendPower)
        return;

    if (m_maxPower < m_minPower)
        return;

    if (m_powerTimer.isActive())
        return;

    const float maxX = 2200;
    const float minX = 600;
    const float maxY = 1500;
    const float minY = 0;
    const float dPower = 0.01;
    float airPathLength = (maxX - m_mcs_x) + (maxY - m_mcs_y);
    const float maximumAirPathLength = (maxX - minX) + (maxY - minY);
    float powerSpan = m_maxPower - m_minPower;
    float dist = airPathLength / maximumAirPathLength;
    float targetPower = m_minPower + powerSpan * dist;

    if (fabs(targetPower - m_lastSentPower) < dPower)
        return;

    m_lastSentPower = targetPower;
    emit changePower(m_lastSentPower / 5.0);

    m_powerTimer.start();
}

void Automator::onMcStateChanged(RayReceiver::State s)
{
    if (!m_working)
        return;
    if (s == RayReceiver::Paused) {
        if(m_mcs_x_check_state != m_mcs_x || m_mcs_y_check_state != m_mcs_y)
        {
           m_mcs_x_check_state = m_mcs_x;
           m_mcs_y_check_state = m_mcs_y;
           return;
        }

        if (!m_compensatorOneShot)
        {
            QTimer::singleShot(1000, this, SLOT(compensate()));
            m_compensatorOneShot = true;
        }
    }
    if (s == RayReceiver::Playing)
        m_compensatorOneShot = false;
}

void Automator::onCameraStateChanged(CaptureController::Status s)
{
    if (s == CaptureController::Status::Stopped)
    {
        m_cameraConnected = false;
        checkWorkingState();
    }

}

void Automator::compensate()
{
    if (!m_working || m_cutModeEnabled)
        return;
    float compensated = compensate(m_lastdz);
    if (compensated > 10) {
        m_message = "No entry in comp table";
        emit messageChanged();
    } else {
        float targetB = compensated;
        QString correction = QString("G90 G0 B%1\n").arg(targetB);
        m_message = correction;
        emit messageChanged();
        qDebug() << correction;
        emit sendToMC(correction);
        emit sendToMC("M24\n");
    }
}

void Automator::scanSnapshot(GcodePlayer::State s)
{
    if (s == GcodePlayer::State::PausedM25)
    {
        QTimer::singleShot(1000, this, SLOT(m_scanSnapshot()));
    }
}

void Automator::scanFinished(GcodePlayer::State s)
{
    if (s == GcodePlayer::State::Stopped && m_state == Scanning)
    {

            delete m_surfaceSpline;

            m_surfaceSpline = new SPLINTER::BSpline(SPLINTER::BSpline::Builder(m_samples).degree(3).build());

            QVector<SurfacePoint> points;
            SurfacePoint point;
            SPLINTER::DenseVector x(2);

            points.reserve((m_scanWidth+1)*(m_scanHeight+1));

            for(int i = 0; i <= m_scanHeight; i++)
                {
                    for(int j = 0; j <= m_scanWidth; j++)
                    {
                        x(0) = i;
                        point.x = i;
                        x(1) = j;
                        point.y = j;
                        point.z = m_surfaceSpline->eval(x);

                        points.append(point);
                    }
                }

            m_surfaceModel->updatePoints(points);

            m_scanComplited = true;
            emit scanStateChanged();

            m_state = m_cutModeEnabled ? AutoCutting : AutoEngraving;
            emit stateChanged(m_state);
    }
}

float Automator::compensate(float dz) const
{
    //                   CAM     ERROR
    const float map[] = {108,	2.12328707444573,
                         107.9,	2.12301535587485,
                         107.8,	2.12274327558481,
                         107.7,	2.12247082643619,
                         107.6,	2.12219800128957,
                         107.5,	2.12192479300556,
                         107.4,	2.12165119444474,
                         107.3,	2.1213771984677,
                         107.2,	2.12110279793503,
                         107.1,	2.12082798570732,
                         107,	2.12055275464516,
                         106.9,	2.12027709760915,
                         106.8,	2.12000100745987,
                         106.7,	2.11972447705791,
                         106.6,	2.11944749926387,
                         106.5,	2.11917006693834,
                         106.4,	2.1188921729419,
                         106.3,	2.11861381013514,
                         106.2,	2.11833497137866,
                         106.1,	2.11805564953305,
                         106,	2.1177758374589,
                         105.9,	2.11749552801679,
                         105.8,	2.11721471406732,
                         105.7,	2.11693338847108,
                         105.6,	2.11665154408866,
                         105.5,	2.11636917378065,
                         105.4,	2.11608627040763,
                         105.3,	2.11580282683021,
                         105.2,	2.11551883590897,
                         105.1,	2.1152342905045,
                         105,	2.11494918347739,
                         104.9,	2.11466350768824,
                         104.8,	2.11437725599762,
                         104.7,	2.11409042126614,
                         104.6,	2.11380299635439,
                         104.5,	2.11351497412294,
                         104.4,	2.11322634743241,
                         104.3,	2.11293710914336,
                         104.2,	2.1126472521164,
                         104.1,	2.11235676921212,
                         104,	2.11206565329111,
                         103.9,	2.11177389721395,
                         103.8,	2.11148149384124,
                         103.7,	2.11118843603356,
                         103.6,	2.11089471665152,
                         103.5,	2.11060032855569,
                         103.4,	2.11030526460667,
                         103.3,	2.11000951766505,
                         103.2,	2.10971308059142,
                         103.1,	2.10941594624637,
                         103,	2.10911810749049,
                         102.9,	2.10881955718438,
                         102.8,	2.10852028818861,
                         102.7,	2.10822029336379,
                         102.6,	2.1079195655705,
                         102.5,	2.10761809766934,
                         102.4,	2.10731588252088,
                         102.3,	2.10701291298573,
                         102.2,	2.10670918192448,
                         102.1,	2.10640468219771,
                         102,	2.10609940666602,
                         101.9,	2.10579334818999,
                         101.8,	2.10548649963022,
                         101.7,	2.10517885384729,
                         101.6,	2.10487040370181,
                         101.5,	2.10456114205435,
                         101.4,	2.1042510617655,
                         101.3,	2.10394015569587,
                         101.2,	2.10362841670604,
                         101.1,	2.10331583765659,
                         101,	2.10300241140813,
                         100.9,	2.10268813082124,
                         100.8,	2.1023729887565,
                         100.7,	2.10205697807452,
                         100.6,	2.10174009163588,
                         100.5,	2.10142232230118,
                         100.4,	2.10110366293099,
                         100.3,	2.10078410638592,
                         100.2,	2.10046364552655,
                         100.1,	2.10014227321348,
                         100,	2.09981998230729,
                         99.9,	2.09949676566858,
                         99.8,	2.09917261615793,
                         99.7,	2.09884752663594,
                         99.6,	2.09852148996319,
                         99.5,	2.09819449900029,
                         99.4,	2.0978665466078,
                         99.3,	2.09753762564634,
                         99.2,	2.09720772897649,
                         99.1,	2.09687684945883,
                         99,	2.09654497995396,
                         98.9,	2.09621211332247,
                         98.8,	2.09587824242496,
                         98.7,	2.095543360122,
                         98.6,	2.09520745927419,
                         98.5,	2.09487053274213,
                         98.4,	2.0945325733864,
                         98.3,	2.09419357406759,
                         98.2,	2.09385352764629,
                         98.1,	2.0935124269831,
                         98,	2.0931702649386,
                         97.9,	2.09282703437338,
                         97.8,	2.09248272814804,
                         97.7,	2.09213733912316,
                         97.6,	2.09179086015934,
                         97.5,	2.09144328411717,
                         97.4,	2.09109460385723,
                         97.3,	2.09074481224012,
                         97.2,	2.09039390212643,
                         97.1,	2.09004186637674,
                         97,	2.08968869785166,
                         96.9,	2.08933438941176,
                         96.8,	2.08897893391764,
                         96.7,	2.08862232422989,
                         96.6,	2.0882645532091,
                         96.5,	2.08790561371586,
                         96.4,	2.08754549861076,
                         96.3,	2.0871842007544,
                         96.2,	2.08682171300735,
                         96.1,	2.08645802823022,
                         96,	2.08609313928359,
                         95.9,	2.08572703902806,
                         95.8,	2.08535972032421,
                         95.7,	2.08499117603263,
                         95.6,	2.08462139901392,
                         95.5,	2.08425038212866,
                         95.4,	2.08387811823745,
                         95.3,	2.08350460020088,
                         95.2,	2.08312982087953,
                         95.1,	2.082753773134,
                         95,	2.08237644982487,
                         94.9,	2.08199784381275,
                         94.8,	2.08161794795821,
                         94.7,	2.08123675512185,
                         94.6,	2.08085425816426,
                         94.5,	2.08047044994603,
                         94.4,	2.08008532332775,
                         94.3,	2.07969887117001,
                         94.2,	2.07931108633341,
                         94.1,	2.07892196167852,
                         94,	2.07853149006595,
                         93.9,	2.07813966435628,
                         93.8,	2.0777464774101,
                         93.7,	2.077351922088,
                         93.6,	2.07695599125058,
                         93.5,	2.07655867775843,
                         93.4,	2.07615997447213,
                         93.3,	2.07575987425227,
                         93.2,	2.07535836995945,
                         93.1,	2.07495545445425,
                         93,	2.07455112059728,
                         92.9,	2.07414536124911,
                         92.8,	2.07373816927033,
                         92.7,	2.07332953752155,
                         92.6,	2.07291945886334,
                         92.5,	2.07250792615631,
                         92.4,	2.07209493226103,
                         92.3,	2.0716804700381,
                         92.2,	2.07126453234811,
                         92.1,	2.07084711205166,
                         92,	2.07042820200932,
                         91.9,	2.0700077950817,
                         91.8,	2.06958588412937,
                         91.7,	2.06916246201295,
                         91.6,	2.068737521593,
                         91.5,	2.06831105573013,
                         91.4,	2.06788305728492,
                         91.3,	2.06745351911797,
                         91.2,	2.06702243408986,
                         91.1,	2.06658979506118,
                         91,	2.06615559489253,
                         90.9,	2.0657198264445,
                         90.8,	2.06528248257768,
                         90.7,	2.06484355615265,
                         90.6,	2.06440304003001,
                         90.5,	2.06396092707035,
                         90.4,	2.06351721013425,
                         90.3,	2.06307188208232,
                         90.2,	2.06262493577514,
                         90.1,	2.06217636407329,
                         90,	2.06172615983738,
                         89.9,	2.06127431592798,
                         89.8,	2.0608208252057,
                         89.7,	2.06036568053112,
                         89.6,	2.05990887476483,
                         89.5,	2.05945040076743,
                         89.4,	2.05899025139949,
                         89.3,	2.05852841952163,
                         89.2,	2.05806489799441,
                         89.1,	2.05759967967844,
                         89,	2.05713275743431,
                         88.9,	2.0566641241226,
                         88.8,	2.0561937726039,
                         88.7,	2.05572169573882,
                         88.6,	2.05524788638792,
                         88.5,	2.05477233741182,
                         88.4,	2.0542950416711,
                         88.3,	2.05381599202634,
                         88.2,	2.05333518133814,
                         88.1,	2.05285260246709,
                         88,	2.05236824827378,
                         87.9,	2.0518821116188,
                         87.8,	2.05139418536274,
                         87.7,	2.05090446236619,
                         87.6,	2.05041293548974,
                         87.5,	2.04991959759399,
                         87.4,	2.04942444153952,
                         87.3,	2.04892746018692,
                         87.2,	2.04842864639678,
                         87.1,	2.0479279930297,
                         87,	2.04742549294626,
                         86.9,	2.04692113900705,
                         86.8,	2.04641492407267,
                         86.7,	2.04590684100371,
                         86.6,	2.04539688266075,
                         86.5,	2.04488504190439,
                         86.4,	2.04437131159522,
                         86.3,	2.04385568459382,
                         86.2,	2.04333815376079,
                         86.1,	2.04281871195672,
                         86,	2.04229735204219,
                         85.9,	2.04177406687781,
                         85.8,	2.04124884932416,
                         85.7,	2.04072169224182,
                         85.6,	2.0401925884914,
                         85.5,	2.03966153093348,
                         85.4,	2.03912851242865,
                         85.3,	2.0385935258375,
                         85.2,	2.03805656402062,
                         85.1,	2.03751761983861,
                         85,	2.03697668615205,
                         84.9,	2.03643375582153,
                         84.8,	2.03588882170765,
                         84.7,	2.035341876671,
                         84.6,	2.03479291357215,
                         84.5,	2.03424192527172,
                         84.4,	2.03368890463028,
                         84.3,	2.03313384450842,
                         84.2,	2.03257673776674,
                         84.1,	2.03201757726583,
                         84,	2.03145635586628,
                         83.9,	2.03089306642868,
                         83.8,	2.03032770181361,
                         83.7,	2.02976025488168,
                         83.6,	2.02919071849346,
                         83.5,	2.02861908550956,
                         83.4,	2.02804534879055,
                         83.3,	2.02746950119704,
                         83.2,	2.02689153558961,
                         83.1,	2.02631144482885,
                         83,	2.02572922177535,
                         82.9,	2.02514485928971,
                         82.8,	2.0245583502325,
                         82.7,	2.02396968746434,
                         82.6,	2.02337886384579,
                         82.5,	2.02278587223747,
                         82.4,	2.02219070549994,
                         82.3,	2.02159335649381,
                         82.2,	2.02099381807967,
                         82.1,	2.02039208311811,
                         82,	2.01978814446971,
                         81.9,	2.01918199499507,
                         81.8,	2.01857362755478,
                         81.7,	2.01796303500942,
                         81.6,	2.0173502102196,
                         81.5,	2.01673514604589,
                         81.4,	2.0161178353489,
                         81.3,	2.0154982709892,
                         81.2,	2.0148764458274,
                         81.1,	2.01425235272407,
                         81,	2.01362598453982,
                         80.9,	2.01299733413523,
                         80.8,	2.01236639437089,
                         80.7,	2.0117331581074,
                         80.6,	2.01109761820534,
                         80.5,	2.0104597675253,
                         80.4,	2.00981959892788,
                         80.3,	2.00917710527366,
                         80.2,	2.00853227942324,
                         80.1,	2.0078851142372,
                         80,	2.00723560257614,
                         79.9,	2.00658373730064,
                         79.8,	2.00592951127131,
                         79.7,	2.00527291734872,
                         79.6,	2.00461394839347,
                         79.5,	2.00395259726614,
                         79.4,	2.00328885682734,
                         79.3,	2.00262271993765,
                         79.2,	2.00195417945765,
                         79.1,	2.00128322824795,
                         79,	2.00060985916912,
                         78.9,	1.99993406508177,
                         78.8,	1.99925583884648,
                         78.7,	1.99857517332384,
                         78.6,	1.99789206137444,
                         78.5,	1.99720649585888,
                         78.4,	1.99651846963774,
                         78.3,	1.99582797557162,
                         78.2,	1.9951350065211,
                         78.1,	1.99443955534677,
                         78,	1.99374161490923,
                         77.9,	1.99304117806907,
                         77.8,	1.99233823768687,
                         77.7,	1.99163278662323,
                         77.6,	1.99092481773873,
                         77.5,	1.99021432389397,
                         77.4,	1.98950129794955,
                         77.3,	1.98878573276604,
                         77.2,	1.98806762120404,
                         77.1,	1.98734695612413,
                         77,	1.98662373038692,
                         76.9,	1.98589793685299,
                         76.8,	1.98516956838293,
                         76.7,	1.98443861783733,
                         76.6,	1.98370507807678,
                         76.5,	1.98296894196188,
                         76.4,	1.98223020235321,
                         76.3,	1.98148885211136,
                         76.2,	1.98074488409692,
                         76.1,	1.97999829117049,
                         76,	1.97924906619265,
                         75.9,	1.978497202024,
                         75.8,	1.97774269152512,
                         75.7,	1.97698552755661,
                         75.6,	1.97622570297906,
                         75.5,	1.97546321065305,
                         75.4,	1.97469804343918,
                         75.3,	1.97393019419804,
                         75.2,	1.97315965579022,
                         75.1,	1.9723864210763,
                         75,	1.97161048291688,
                         74.9,	1.97083183417256,
                         74.8,	1.97005046770391,
                         74.7,	1.96926637637153,
                         74.6,	1.96847955303602,
                         74.5,	1.96768999055795,
                         74.4,	1.96689768179793,
                         74.3,	1.96610261961654,
                         74.2,	1.96530479687437,
                         74.1,	1.96450420643202,
                         74,	1.96370084115007,
                         73.9,	1.96289469388911,
                         73.8,	1.96208575750974,
                         73.7,	1.96127402487254,
                         73.6,	1.96045948883811,
                         73.5,	1.95964214226704,
                         73.4,	1.95882197801991,
                         73.3,	1.95799898895732,
                         73.2,	1.95717316793985,
                         73.1,	1.95634450782811,
                         73,	1.95551300148267,
                         72.9,	1.95467864176413,
                         72.8,	1.95384142153308,
                         72.7,	1.95300133365011,
                         72.6,	1.95215837097581,
                         72.5,	1.95131252637077,
                         72.4,	1.95046379269558,
                         72.3,	1.94961216281083,
                         72.2,	1.94875762957711,
                         72.1,	1.94790018585502,
                         72,	1.94703982450514,
                         71.9,	1.94617653838806,
                         71.8,	1.94531032036438,
                         71.7,	1.94444116329468,
                         71.6,	1.94356906003955,
                         71.5,	1.9426940034596,
                         71.4,	1.94181598641539,
                         71.3,	1.94093500176753,
                         71.2,	1.94005104237661,
                         71.1,	1.93916410110322,
                         71,	1.93827417080794,
                         70.9,	1.93738124435137,
                         70.8,	1.9364853145941,
                         70.7,	1.93558637439672,
                         70.6,	1.93468441661982,
                         70.5,	1.93377943412398,
                         70.4,	1.93287141976981,
                         70.3,	1.93196036641789,
                         70.2,	1.93104626692881,
                         70.1,	1.93012911416316,
                         70,	1.92920890098153,
                         69.9,	1.92828562024452,
                         69.8,	1.9273592648127,
                         69.7,	1.92642982754668,
                         69.6,	1.92549730130705,
                         69.5,	1.92456167895439,
                         69.4,	1.92362295334929,
                         69.3,	1.92268111735235,
                         69.2,	1.92173616382416,
                         69.1,	1.9207880856253,
                         69,	1.91983687561637,
                         68.9,	1.91888252665795,
                         68.8,	1.91792503161064,
                         68.7,	1.91696438333503,
                         68.6,	1.91600057469171,
                         68.5,	1.91503359854127,
                         68.4,	1.9140634477443,
                         68.3,	1.91309011516138,
                         68.2,	1.91211359365312,
                         68.1,	1.9111338760801,
                         68,	1.9101509553029,
                         67.9,	1.90916482418213,
                         67.8,	1.90817547557838,
                         67.7,	1.90718290235222,
                         67.6,	1.90618709736426,
                         67.5,	1.90518805347508,
                         67.4,	1.90418576354528,
                         67.3,	1.90318022043544,
                         67.2,	1.90217141700615,
                         67.1,	1.90115934611801,
                         67,	1.90014400063161,
                         66.9,	1.89912537340753,
                         66.8,	1.89810345730637,
                         66.7,	1.89707824518871,
                         66.6,	1.89604972991515,
                         66.5,	1.89501790434628,
                         66.4,	1.89398276134269,
                         66.3,	1.89294429376497,
                         66.2,	1.89190249447371,
                         66.1,	1.8908573563295,
                         66,	1.88980887219293,
                         65.9,	1.88875703492458,
                         65.8,	1.88770183738506,
                         65.7,	1.88664327243496,
                         65.6,	1.88558133293485,
                         65.5,	1.88451601174534,
                         65.4,	1.88344730172701,
                         65.3,	1.88237519574045,
                         65.2,	1.88129968664626,
                         65.1,	1.88022076730502,
                         65,	1.87913843057732,
                         64.9,	1.87805266932377,
                         64.8,	1.87696347640493,
                         64.7,	1.87587084468142,
                         64.6,	1.87477476701381,
                         64.5,	1.8736752362627,
                         64.4,	1.87257224528867,
                         64.3,	1.87146578695232,
                         64.2,	1.87035585411425,
                         64.1,	1.86924243963503,
                         64,	1.86812553637526,
                         63.9,	1.86700513719553,
                         63.8,	1.86588123495643,
                         63.7,	1.86475382251855,
                         63.6,	1.86362289274248,
                         63.5,	1.86248843848882,
                         63.4,	1.86135045261815,
                         63.3,	1.86020892799106,
                         63.2,	1.85906385746814,
                         63.1,	1.85791523390998,
                         63,	1.85676305017719,
                         62.9,	1.85560729913033,
                         62.8,	1.85444797363001,
                         62.7,	1.85328506653682,
                         62.6,	1.85211857071134,
                         62.5,	1.85094847901416,
                         62.4,	1.84977478430589,
                         62.3,	1.8485974794471,
                         62.2,	1.84741655729839,
                         62.1,	1.84623201072035,
                         62,	1.84504383257356,
                         61.9,	1.84385201571863,
                         61.8,	1.84265655301613,
                         61.7,	1.84145743732667,
                         61.6,	1.84025466151083,
                         61.5,	1.83904821842919,
                         61.4,	1.83783810094236,
                         61.3,	1.83662430191092,
                         61.2,	1.83540681419546,
                         61.1,	1.83418563065657,
                         61,	1.83296074415485,
                         60.9,	1.83173214755088,
                         60.8,	1.83049983370526,
                         60.7,	1.82926379547857,
                         60.6,	1.82802402573141,
                         60.5,	1.82678051732436,
                         60.4,	1.82553326311801,
                         60.3,	1.82428225597297,
                         60.2,	1.82302748874981,
                         60.1,	1.82176895430912,
                         60,	1.82050664551151,
                         59.9,	1.81924055521755,
                         59.8,	1.81797067628784,
                         59.7,	1.81669700158298,
                         59.6,	1.81541952396354,
                         59.5,	1.81413823629012,
                         59.4,	1.81285313142331,
                         59.3,	1.8115642022237,
                         59.2,	1.81027144155189,
                         59.1,	1.80897484226845,
                         59,	1.80767439723399,
                         58.9,	1.80637009930909,
                         58.8,	1.80506194135435,
                         58.7,	1.80374991623034,
                         58.6,	1.80243401679768,
                         58.5,	1.80111423591693,
                         58.4,	1.79979056644871,
                         58.3,	1.79846300125358,
                         58.2,	1.79713153319216,
                         58.1,	1.79579615512502,
                         58,	1.79445685991276,
                         57.9,	1.79311364041596,
                         57.8,	1.79176648949522,
                         57.7,	1.79041540001113,
                         57.6,	1.78906036482428,
                         57.5,	1.78770137679526,
                         57.4,	1.78633842878466,
                         57.3,	1.78497151365307,
                         57.2,	1.78360062426108,
                         57.1,	1.78222575346928,
                         57,	1.78084689413826,
                         56.9,	1.77946403912862,
                         56.8,	1.77807718130093,
                         56.7,	1.7766863135158,
                         56.6,	1.77529142863381,
                         56.5,	1.77389251951556,
                         56.4,	1.77248957902163,
                         56.3,	1.77108260001262,
                         56.2,	1.76967157534911,
                         56.1,	1.76825649789169,
                         56,	1.76683736050097,
                         55.9,	1.76541415603752,
                         55.8,	1.76398687736193,
                         55.7,	1.76255551733481,
                         55.6,	1.76112006881673,
                         55.5,	1.75968052466829,
                         55.4,	1.75823687775008,
                         55.3,	1.75678912092268,
                         55.2,	1.7553372470467,
                         55.1,	1.75388124898272,
                         55,	1.75242111959133,
                         54.9,	1.75095685173312,
                         54.8,	1.74948843826868,
                         54.7,	1.7480158720586,
                         54.6,	1.74653914596348,
                         54.5,	1.7450582528439,
                         54.4,	1.74357318556045,
                         54.3,	1.74208393697373,
                         54.2,	1.74059049994432,
                         54.1,	1.73909286733282,
                         54,	1.73759103199981,
                         53.9,	1.73608498680588,
                         53.8,	1.73457472461164,
                         53.7,	1.73306023827766,
                         53.6,	1.73154152066453,
                         53.5,	1.73001856463286,
                         53.4,	1.72849136304322,
                         53.3,	1.72695990875621,
                         53.2,	1.72542419463242,
                         53.1,	1.72388421353244,
                         53,	1.72233995831686,
                         52.9,	1.72079142184627,
                         52.8,	1.71923859698126,
                         52.7,	1.71768147658242,
                         52.6,	1.71612005351034,
                         52.5,	1.71455432062562,
                         52.4,	1.71298427078883,
                         52.3,	1.71140989686058,
                         52.2,	1.70983119170146,
                         52.1,	1.70824814817205,
                         52,	1.70666075913294,
                         51.9,	1.70506901744473,
                         51.8,	1.703472915968,
                         51.7,	1.70187244756335,
                         51.6,	1.70026760509136,
                         51.5,	1.69865838141264,
                         51.4,	1.69704476938775,
                         51.3,	1.69542676187731,
                         51.2,	1.6938043517419,
                         51.1,	1.6921775318421,
                         51,	1.69054629503851,
                         50.9,	1.68891063419172,
                         50.8,	1.68727054216232,
                         50.7,	1.68562601181091,
                         50.6,	1.68397703599806,
                         50.5,	1.68232360758437,
                         50.4,	1.68066571943044,
                         50.3,	1.67900336439685,
                         50.2,	1.67733653534419,
                         50.1,	1.67566522513305,
                         50,	1.67398942662403,
                         49.9,	1.67230913267771,
                         49.8,	1.67062433615469,
                         49.7,	1.66893502991555,
                         49.6,	1.66724120682088,
                         49.5,	1.66554285973129,
                         49.4,	1.66383998150734,
                         49.3,	1.66213256500965,
                         49.2,	1.66042060309879,
                         49.1,	1.65870408863536,
                         49,	1.65698301447995,
                         48.9,	1.65525737349315,
                         48.8,	1.65352715853555,
                         48.7,	1.65179236246773,
                         48.6,	1.6500529781503,
                         48.5,	1.64830899844383,
                         48.4,	1.64656041620893,
                         48.3,	1.64480722430618,
                         48.2,	1.64304941559617,
                         48.1,	1.64128698293949,
                         48,	1.63951991919674,
                         47.9,	1.6377482172285,
                         47.8,	1.63597186989536,
                         47.7,	1.63419087005792,
                         47.6,	1.63240521057676,
                         47.5,	1.63061488431247,
                         47.4,	1.62881988412565,
                         47.3,	1.62702020287689,
                         47.2,	1.62521583342678,
                         47.1,	1.6234067686359,
                         47,	1.62159300136484,
                         46.9,	1.61977452447421,
                         46.8,	1.61795133082458,
                         46.7,	1.61612341327656,
                         46.6,	1.61429076469072,
                         46.5,	1.61245337792766,
                         46.4,	1.61061124584797,
                         46.3,	1.60876436131225,
                         46.2,	1.60691271718107,
                         46.1,	1.60505630631503,
                         46,	1.60319512157473,
                         45.9,	1.60132915582075,
                         45.8,	1.59945840191368,
                         45.7,	1.59758285271412,
                         45.6,	1.59570250108265,
                         45.5,	1.59381733987986,
                         45.4,	1.59192736196635,
                         45.3,	1.5900325602027,
                         45.2,	1.58813292744951,
                         45.1,	1.58622845656736,
                         45,	1.58431914041685,
                         44.9,	1.58240497185857,
                         44.8,	1.58048594375311,
                         44.7,	1.57856204896105,
                         44.6,	1.57663328034299,
                         44.5,	1.57469963075952,
                         44.4,	1.57276109307123,
                         44.3,	1.57081766013871,
                         44.2,	1.56886932482255,
                         44.1,	1.56691607998334,
                         44,	1.56495791848167,
                         43.9,	1.56299483317813,
                         43.8,	1.56102681693332,
                         43.7,	1.55905386260781,
                         43.6,	1.55707596306221,
                         43.5,	1.55509311115711,
                         43.4,	1.55310529975308,
                         43.3,	1.55111252171074,
                         43.2,	1.54911476989065,
                         43.1,	1.54711203715342,
                         43,	1.54510431635964,
                         42.9,	1.54309160036989,
                         42.8,	1.54107388204477,
                         42.7,	1.53905115424487,
                         42.6,	1.53702340983077,
                         42.5,	1.53499064166308,
                         42.4,	1.53295284260237,
                         42.3,	1.53091000550923,
                         42.2,	1.52886212324427,
                         42.1,	1.52680918866807,
                         42,	1.52475119464122,
                         41.9,	1.52268813402431,
                         41.8,	1.52061999967793,
                         41.7,	1.51854678446267,
                         41.6,	1.51646848123913,
                         41.5,	1.51438508286788,
                         41.4,	1.51229658220953,
                         41.3,	1.51020297212467,
                         41.2,	1.50810424547387,
                         41.1,	1.50600039511774,
                         41,	1.50389141391687,
                         40.9,	1.50177729473184,
                         40.8,	1.49965803042325,
                         40.7,	1.49753361385168,
                         40.6,	1.49540403787773,
                         40.5,	1.49326929536199,
                         40.4,	1.49112937916504,
                         40.3,	1.48898428214748,
                         40.2,	1.48683399716991,
                         40.1,	1.4846785170929,
                         40,	1.48251783477704,
                         39.9,	1.48035194308294,
                         39.8,	1.47818083487118,
                         39.7,	1.47600450300235,
                         39.6,	1.47382294033705,
                         39.5,	1.47163613973585,
                         39.4,	1.46944409405935,
                         39.3,	1.46724679616815,
                         39.2,	1.46504423892283,
                         39.1,	1.46283641518399,
                         39,	1.46062331781221,
                         38.9,	1.45840493966808,
                         38.8,	1.4561812736122,
                         38.7,	1.45395231250515,
                         38.6,	1.45171804920753,
                         38.5,	1.44947847657992,
                         38.4,	1.44723358748292,
                         38.3,	1.44498337477712,
                         38.2,	1.44272783132311,
                         38.1,	1.44046694998147,
                         38,	1.43820072361281,
                         37.9,	1.4359291450777,
                         37.8,	1.43365220723674,
                         37.7,	1.43136990295052,
                         37.6,	1.42908222507963,
                         37.5,	1.42678916648467,
                         37.4,	1.42449072002621,
                         37.3,	1.42218687856486,
                         37.2,	1.4198776349612,
                         37.1,	1.41756298207582,
                         37,	1.41524291276931,
                         36.9,	1.41291741990227,
                         36.8,	1.41058649633528,
                         36.7,	1.40825013492894,
                         36.6,	1.40590832854383,
                         36.5,	1.40356107004054,
                         36.4,	1.40120835227968,
                         36.3,	1.39885016812181,
                         36.2,	1.39648651042755,
                         36.1,	1.39411737205747,
                         36,	1.39174274587217,
                         35.9,	1.38936262473224,
                         35.8,	1.38697700149827,
                         35.7,	1.38458586903084,
                         35.6,	1.38218922019056,
                         35.5,	1.37978704783801,
                         35.4,	1.37737934483377,
                         35.3,	1.37496610403845,
                         35.2,	1.37254731831263,
                         35.1,	1.3701229805169,
                         35,	1.36769308351185,
                         34.9,	1.36525762015808,
                         34.8,	1.36281658331616,
                         34.7,	1.36036996584671,
                         34.6,	1.35791776061029,
                         34.5,	1.35545996046751,
                         34.4,	1.35299655827896,
                         34.3,	1.35052754690522,
                         34.2,	1.34805291920689,
                         34.1,	1.34557266804455,
                         34,	1.3430867862788,
                         33.9,	1.34059526677023,
                         33.8,	1.33809810237943,
                         33.7,	1.33559528596698,
                         33.6,	1.33308681039348,
                         33.5,	1.33057266851952,
                         33.4,	1.3280528532057,
                         33.3,	1.32552735731259,
                         33.2,	1.32299617370079,
                         33.1,	1.32045929523089,
                         33,	1.31791671476349,
                         32.9,	1.31536842515916,
                         32.8,	1.31281441927851,
                         32.7,	1.31025468998212,
                         32.6,	1.30768923013059,
                         32.5,	1.3051180325845,
                         32.4,	1.30254109020444,
                         32.3,	1.29995839585101,
                         32.2,	1.29736994238479,
                         32.1,	1.29477572266638,
                         32,	1.29217572955636,
                         31.9,	1.28956995591533,
                         31.8,	1.28695839460388,
                         31.7,	1.28434103848259,
                         31.6,	1.28171788041207,
                         31.5,	1.27908891325289,
                         31.4,	1.27645412986565,
                         31.3,	1.27381352311094,
                         31.2,	1.27116708584934,
                         31.1,	1.26851481094146,
                         31,	1.26585669124788,
                         30.9,	1.26319271962919,
                         30.8,	1.26052288894599,
                         30.7,	1.25784719205885,
                         30.6,	1.25516562182838,
                         30.5,	1.25247817111516,
                         30.4,	1.24978483277978,
                         30.3,	1.24708559968283,
                         30.2,	1.24438046468492,
                         30.1,	1.24166942064661,
                         30,	1.23895246042851,
                         29.9,	1.23622957689121,
                         29.8,	1.23350076289529,
                         29.7,	1.23076601130135,
                         29.6,	1.22802531496998,
                         29.5,	1.22527866676176,
                         29.4,	1.22252605953729,
                         29.3,	1.21976748615716,
                         29.2,	1.21700293948196,
                         29.1,	1.21423241237228,
                         29,	1.2114558976887,
                         28.9,	1.20867338829183,
                         28.8,	1.20588487704225,
                         28.7,	1.20309035680055,
                         28.6,	1.20028982042732,
                         28.5,	1.19748326078316,
                         28.4,	1.19467067072864,
                         28.3,	1.19185204312437,
                         28.2,	1.18902737083093,
                         28.1,	1.18619664670892,
                         28,	1.18335986361892,
                         27.9,	1.18051701442152,
                         27.8,	1.17766809197733,
                         27.7,	1.17481308914691,
                         27.6,	1.17195199879087,
                         27.5,	1.1690848137698,
                         27.4,	1.16621152694429,
                         27.3,	1.16333213117492,
                         27.2,	1.16044661932229,
                         27.1,	1.15755498424699,
                         27,	1.15465721880961,
                         26.9,	1.15175331587074,
                         26.8,	1.14884326829097,
                         26.7,	1.14592706893089,
                         26.6,	1.14300471065109,
                         26.5,	1.14007618631216,
                         26.4,	1.13714148877469,
                         26.3,	1.13420061089928,
                         26.2,	1.1312535455465,
                         26.1,	1.12830028557696,
                         26,	1.12534082385125,
                         25.9,	1.12237515322994,
                         25.8,	1.11940326657365,
                         25.7,	1.11642515674294,
                         25.6,	1.11344081659842,
                         25.5,	1.11045023900068,
                         25.4,	1.10745341681031,
                         25.3,	1.10445034288789,
                         25.2,	1.10144101009402,
                         25.1,	1.09842541128928,
                         25,	1.09540353933428,
                         24.9,	1.09237538708959,
                         24.8,	1.08934094741581,
                         24.7,	1.08630021317353,
                         24.6,	1.08325317722334,
                         24.5,	1.08019983242583,
                         24.4,	1.07714017164159,
                         24.3,	1.07407418773122,
                         24.2,	1.07100187355529,
                         24.1,	1.06792322197441,
                         24,	1.06483822584916,
                         23.9,	1.06174687804013,
                         23.8,	1.05864917140792,
                         23.7,	1.05554509881311,
                         23.6,	1.05243465311629,
                         23.5,	1.04931782717806,
                         23.4,	1.04619461385901,
                         23.3,	1.04306500601972,
                         23.2,	1.03992899652079,
                         23.1,	1.0367865782228,
                         23,	1.03363774398635,
                         22.9,	1.03048248667203,
                         22.8,	1.02732079914043,
                         22.7,	1.02415267425213,
                         22.6,	1.02097810486774,
                         22.5,	1.01779708384783,
                         22.4,	1.01460960405301,
                         22.3,	1.01141565834385,
                         22.2,	1.00821523958096,
                         22.1,	1.00500834062492,
                         22,	1.00179495433632,
                         21.9,	0.998575073575747,
                         21.8,	0.995348691203801,
                         21.7,	0.992115800081068,
                         21.6,	0.988876393068139,
                         21.5,	0.985630463025604,
                         21.4,	0.982378002814054,
                         21.3,	0.979119005294078,
                         21.2,	0.975853463326268,
                         21.1,	0.972581369771214,
                         21,	0.969302717489507,
                         20.9,	0.966017499341736,
                         20.8,	0.962725708188493,
                         20.7,	0.959427336890367,
                         20.6,	0.95612237830795,
                         20.5,	0.952810825301831,
                         20.4,	0.949492670732602,
                         20.3,	0.946167907460852,
                         20.2,	0.942836528347172,
                         20.1,	0.939498526252152,
                         20,	0.936153894036384,
                         19.9,	0.932802624560457,
                         19.8,	0.929444710684962,
                         19.7,	0.92608014527049,
                         19.6,	0.922708921177629,
                         19.5,	0.919331031266973,
                         19.4,	0.91594646839911,
                         19.3,	0.912555225434631,
                         19.2,	0.909157295234127,
                         19.1,	0.905752670658188,
                         19,	0.902341344567405,
                         18.9,	0.898923309822368,
                         18.8,	0.895498559283667,
                         18.7,	0.892067085811893,
                         18.6,	0.888628882267636,
                         18.5,	0.885183941511487,
                         18.4,	0.881732256404037,
                         18.3,	0.878273819805875,
                         18.2,	0.874808624577593,
                         18.1,	0.87133666357978,
                         18,	0.867857929673027,
                         17.9,	0.864372415717925,
                         17.8,	0.860880114575064,
                         17.7,	0.857381019105035,
                         17.6,	0.853875122168427,
                         17.5,	0.850362416625832,
                         17.4,	0.84684289533784,
                         17.3,	0.843316551165041,
                         17.2,	0.839783376968026,
                         17.1,	0.836243365607385,
                         17,	0.832696509943709,
                         16.9,	0.829142802837588,
                         16.8,	0.825582237149613,
                         16.7,	0.822014805740374,
                         16.6,	0.818440501470461,
                         16.5,	0.814859317200465,
                         16.4,	0.811271245790977,
                         16.3,	0.807676280102587,
                         16.2,	0.804074412995885,
                         16.1,	0.800465637331462,
                         16,	0.796849945969908,
                         15.9,	0.793227331771815,
                         15.8,	0.789597787597771,
                         15.7,	0.785961306308368,
                         15.6,	0.782317880764196,
                         15.5,	0.778667503825845,
                         15.4,	0.775010168353907,
                         15.3,	0.771345867208971,
                         15.2,	0.767674593251628,
                         15.1,	0.763996339342469,
                         15,	0.760311098342083,
                         14.9,	0.756618863111062,
                         14.8,	0.752919626509996,
                         14.7,	0.749213381399474,
                         14.6,	0.745500120640089,
                         14.5,	0.74177983709243,
                         14.4,	0.738052523617087,
                         14.3,	0.734318173074651,
                         14.2,	0.730576778325713,
                         14.1,	0.726828332230863,
                         14,	0.723072827650691,
                         13.9,	0.719310257445789,
                         13.8,	0.715540614476746,
                         13.7,	0.711763891604152,
                         13.6,	0.707980081688599,
                         13.5,	0.704189177590676,
                         13.4,	0.700391172170975,
                         13.3,	0.696586058290085,
                         13.2,	0.692773828808598,
                         13.1,	0.688954476587103,
                         13,	0.685127994486191,
                         12.9,	0.681294375366453,
                         12.8,	0.677453612088478,
                         12.7,	0.673605697512858,
                         12.6,	0.669750624500183,
                         12.5,	0.665888385911043,
                         12.4,	0.662018974606029,
                         12.3,	0.658142383445731,
                         12.2,	0.65425860529074,
                         12.1,	0.650367633001646,
                         12,	0.64646945943904,
                         11.9,	0.642564077463512,
                         11.8,	0.638651479935652,
                         11.7,	0.634731659716051,
                         11.6,	0.6308046096653,
                         11.5,	0.626870322643988,
                         11.4,	0.622928791512707,
                         11.3,	0.618980009132047,
                         11.2,	0.615023968362598,
                         11.1,	0.611060662064951,
                         11,	0.607090083099696,
                         10.9,	0.603112224327423,
                         10.8,	0.599127078608724,
                         10.7,	0.595134638804188,
                         10.6,	0.591134897774407,
                         10.5,	0.58712784837997,
                         10.4,	0.583113483481467,
                         10.3,	0.579091795939491,
                         10.2,	0.57506277861463,
                         10.1,	0.571026424367475,
                         10,	0.566982726058617,
                         9.9,	0.562931676548646,
                         9.8,	0.558873268698153,
                         9.7,	0.554807495367729,
                         9.6,	0.550734349417962,
                         9.5,	0.546653823709445,
                         9.4,	0.542565911102768,
                         9.3,	0.53847060445852,
                         9.2,	0.534367896637293,
                         9.1,	0.530257780499676,
                         9,	0.526140248906261,
                         8.9,	0.522015294717638,
                         8.8,	0.517882910794397,
                         8.7,	0.513743089997129,
                         8.6,	0.509595825186424,
                         8.5,	0.505441109222873,
                         8.4,	0.501278934967066,
                         8.3,	0.497109295279593,
                         8.2,	0.492932183021045,
                         8.1,	0.488747591052013,
                         8,	0.484555512233087,
                         7.9,	0.480355939424857,
                         7.8,	0.476148865487914,
                         7.7,	0.471934283282848,
                         7.6,	0.46771218567025,
                         7.5,	0.463482565510711,
                         7.4,	0.45924541566482,
                         7.3,	0.455000728993168,
                         7.2,	0.450748498356345,
                         7.1,	0.446488716614943,
                         7,	0.442221376629551,
                         6.9,	0.437946471260761,
                         6.8,	0.433663993369161,
                         6.7,	0.429373935815344,
                         6.6,	0.425076291459899,
                         6.5,	0.420771053163417,
                         6.4,	0.416458213786487,
                         6.3,	0.412137766189702,
                         6.2,	0.407809703233651,
                         6.1,	0.403474017778924,
                         6,	0.399130702686113,
                         5.9,	0.394779750815807,
                         5.8,	0.390421155028597,
                         5.7,	0.386054908185074,
                         5.6,	0.381681003145827,
                         5.5,	0.377299432771448,
                         5.4,	0.372910189922527,
                         5.3,	0.368513267459654,
                         5.2,	0.36410865824342,
                         5.1,	0.359696355134415,
                         5,	0.35527635099323,
                         4.9,	0.350848638680454,
                         4.8,	0.34641321105668,
                         4.7,	0.341970060982496,
                         4.6,	0.337519181318494,
                         4.5,	0.333060564925264,
                         4.4,	0.328594204663396,
                         4.3,	0.324120093393482,
                         4.2,	0.31963822397611,
                         4.1,	0.315148589271872,
                         4,	0.310651182141359,
                         3.9,	0.30614599544516,
                         3.8,	0.301633022043867,
                         3.7,	0.297112254798069,
                         3.6,	0.292583686568357,
                         3.5,	0.288047310215322,
                         3.4,	0.283503118599553,
                         3.3,	0.278951104581643,
                         3.2,	0.27439126102218,
                         3.1,	0.269823580781755,
                         3,	0.265248056720959,
                         2.9,	0.260664681700383,
                         2.8,	0.256073448580616,
                         2.7,	0.25147435022225,
                         2.6,	0.246867379485874,
                         2.5,	0.242252529232079,
                         2.4,	0.237629792321456,
                         2.3,	0.232999161614595,
                         2.2,	0.228360629972086,
                         2.1,	0.223714190254521,
                         2,	0.219059835322489,
                         1.9,	0.21439755803658,
                         1.8,	0.209727351257386,
                         1.7,	0.205049207845497,
                         1.6,	0.200363120661503,
                         1.5,	0.195669082565995,
                         1.4,	0.190967086419562,
                         1.3,	0.186257125082797,
                         1.2,	0.181539191416288,
                         1.1,	0.176813278280627,
                         1,	0.172079378536405,
                         0.900000000000002,	0.16733748504421,
                         0.800000000000004,	0.162587590664635,
                         0.700000000000003,	0.157829688258268,
                         0.600000000000001,	0.153063770685702,
                         0.500000000000004,	0.148289830807526,
                         0.400000000000002,	0.14350786148433,
                         0.300000000000004,	0.138717855576706,
                         0.200000000000003,	0.133919805945243,
                         0.100000000000001,	0.129113705450533,
                         0,	0.124299546953165,
                         -0.0999999999999979,	0.11947732331373,
                         -0.199999999999996,	0.114647027392819,
                         -0.299999999999997,	0.109808652051022,
                         -0.399999999999999,	0.104962190148929,
                         -0.499999999999996,	0.10010763454713,
                         -0.599999999999998,	0.0952449781062176,
                         -0.699999999999996,	0.0903742136867807,
                         -0.799999999999997,	0.0854953341494098,
                         -0.899999999999999,	0.0806083323546956,
                         -0.999999999999996,	0.0757132011632287,
                         -1.1,	0.0708099334355992,
                         -1.2,	0.0658985220323981,
                         -1.3,	0.0609789598142152,
                         -1.4,	0.0560512396416413,
                         -1.5,	0.051115354375267,
                         -1.6,	0.0461712968756825,
                         -1.7,	0.0412190600034785,
                         -1.8,	0.0362586366192451,
                         -1.9,	0.031290019583573,
                         -2,	0.0263132017570528,
                         -2.1,	0.0213281760002747,
                         -2.2,	0.0163349351738291,
                         -2.3,	0.0113334721383066,
                         -2.4,	0.00632377975429783,
                         -2.5,	0.0013058508823931,
                         -2.6,	-0.00372032161681721,
                         -2.7,	-0.00875474488274268,
                         -2.8,	-0.0137974260547925,
                         -2.9,	-0.0188483722723768,
                         -3,	-0.0239075906749045,
                         -3.1,	-0.0289750884017856,
                         -3.2,	-0.0340508725924295,
                         -3.3,	-0.0391349503862458,
                         -3.4,	-0.0442273289226438,
                         -3.5,	-0.0493280153410332,
                         -3.6,	-0.0544370167808235,
                         -3.7,	-0.0595543403814245,
                         -3.8,	-0.0646799932822452,
                         -3.9,	-0.0698139826226958,
                         -4,	-0.0749563155421852,
                         -4.1,	-0.0801069991801235,
                         -4.2,	-0.08526604067592,
                         -4.3,	-0.0904334471689843,
                         -4.4,	-0.0956092257987257,
                         -4.5,	-0.100793383704554,
                         -4.6,	-0.105985928025879,
                         -4.7,	-0.111186865902109,
                         -4.8,	-0.116396204472655,
                         -4.9,	-0.121613950876926,
                         -5,	-0.126840112254331,
                         -5.1,	-0.132074695744281,
                         -5.2,	-0.137317708486184,
                         -5.3,	-0.142569157619451,
                         -5.4,	-0.14782905028349,
                         -5.5,	-0.153097393617711,
                         -5.6,	-0.158374194761524,
                         -5.7,	-0.163659460854339,
                         -5.8,	-0.168953199035564,
                         -5.9,	-0.17425541644461,
                         -6,	-0.179566120220885,
                         -6.1,	-0.1848853175038,
                         -6.2,	-0.190213015432765,
                         -6.3,	-0.195549221147187,
                         -6.4,	-0.200893941786478,
                         -6.5,	-0.206247184490047,
                         -6.6,	-0.211608956397303,
                         -6.7,	-0.216979264647655,
                         -6.8,	-0.222358116380514,
                         -6.9,	-0.227745518735289,
                         -7,	-0.233141478851388,
                         -7.1,	-0.238546003868223,
                         -7.2,	-0.243959100925203,
                         -7.3,	-0.249380777161736,
                         -7.4,	-0.254811039717233,
                         -7.5,	-0.260249895731103,
                         -7.6,	-0.265697352342756,
                         -7.7,	-0.271153416691601,
                         -7.8,	-0.276618095917047,
                         -7.9,	-0.282091397158505,
                         -8,	-0.287573327555383,
                         -8.1,	-0.293063894247092,
                         -8.2,	-0.298563104373041,
                         -8.3,	-0.304070965072639,
                         -8.4,	-0.309587483485297,
                         -8.5,	-0.315112666750422,
                         -8.6,	-0.320646522007426,
                         -8.7,	-0.326189056395717,
                         -8.8,	-0.331740277054706,
                         -8.9,	-0.337300191123801,
                         -9,	-0.342868805742412,
                         -9.1,	-0.348446128049949,
                         -9.2,	-0.354032165185822,
                         -9.3,	-0.359626924289439,
                         -9.4,	-0.36523041250021,
                         -9.5,	-0.370842636957546,
                         -9.6,	-0.376463604800855,
                         -9.7,	-0.382093323169547,
                         -9.8,	-0.387731799203031,
                         -9.9,	-0.393379040040718,
                         -10,	-0.399035052822016,
                         -10.1,	-0.404699844686336,
                         -10.2,	-0.410373422773086,
                         -10.3,	-0.416055794221676,
                         -10.4,	-0.421746966171517,
                         -10.5,	-0.427446945762016,
                         -10.6,	-0.433155740132585,
                         -10.7,	-0.438873356422632,
                         -10.8,	-0.444599801771567,
                         -10.9,	-0.450335083318799,
                         -11,	-0.456079208203738,
                         -11.1,	-0.461832183565794,
                         -11.2,	-0.467594016544377,
                         -11.3,	-0.473364714278894,
                         -11.4,	-0.479144283908758,
                         -11.5,	-0.484932732573376,
                         -11.6,	-0.490730067412158,
                         -11.7,	-0.496536295564514,
                         -11.8,	-0.502351424169853,
                         -11.9,	-0.508175460367586,
                         -12,	-0.51400841129712,
                         -12.1,	-0.519850284097867,
                         -12.2,	-0.525701085909236,
                         -12.3,	-0.531560823870635,
                         -12.4,	-0.537429505121475,
                         -12.5,	-0.543307136801166,
                         -12.6,	-0.549193726049116,
                         -12.7,	-0.555089280004735,
                         -12.8,	-0.560993805807433,
                         -12.9,	-0.56690731059662,
                         -13,	-0.572829801511704,
                         -13.1,	-0.578761285692096,
                         -13.2,	-0.584701770277205,
                         -13.3,	-0.59065126240644,
                         -13.4,	-0.596609769219211,
                         -13.5,	-0.602577297854928,
                         -13.6,	-0.608553855453001,
                         -13.7,	-0.614539449152838,
                         -13.8,	-0.620534086093849,
                         -13.9,	-0.626537773415444,
                         -14,	-0.632550518257031,
                         -14.1,	-0.638572327758023,
                         -14.2,	-0.644603209057826,
                         -14.3,	-0.650643169295852,
                         -14.4,	-0.656692215611508,
                         -14.5,	-0.662750355144206,
                         -14.6,	-0.668817595033355,
                         -14.7,	-0.674893942418363,
                         -14.8,	-0.680979404438642,
                         -14.9,	-0.687073988233599,
                         -15,	-0.693177700942645,
                         -15.1,	-0.69929054970519,
                         -15.2,	-0.705412541660642,
                         -15.3,	-0.711543683948411,
                         -15.4,	-0.717683983707908,
                         -15.5,	-0.723833448078541,
                         -15.6,	-0.72999208419972,
                         -15.7,	-0.736159899210855,
                         -15.8,	-0.742336900251354,
                         -15.9,	-0.748523094460628,
                         -16,	-0.754718488978087,
                         -16.1,	-0.760923090943139,
                         -16.2,	-0.767136907495194,
                         -16.3,	-0.773359945773662,
                         -16.4,	-0.779592212917952,
                         -16.5,	-0.785833716067475,
                         -16.6,	-0.792084462361638,
                         -16.7,	-0.798344458939853,
                         -16.8,	-0.804613712941528,
                         -16.9,	-0.810892231506073,
                         -17,	-0.817180021772899,
                         -17.1,	-0.823477090881412,
                         -17.2,	-0.829783445971024,
                         -17.3,	-0.836099094181145,
                         -17.4,	-0.842424042651183,
                         -17.5,	-0.84875829852055,
                         -17.6,	-0.855101868928652,
                         -17.7,	-0.861454761014901,
                         -17.8,	-0.867816981918706,
                         -17.9,	-0.874188538779476,
                         -18,	-0.880569438736622,
                         -18.1,	-0.886959688929552,
                         -18.2,	-0.893359296497676,
                         -18.3,	-0.899768268580403,
                         -18.4,	-0.906186612317144,
                         -18.5,	-0.912614334847308,
                         -18.6,	-0.919051443310303,
                         -18.7,	-0.92549794484554,
                         -18.8,	-0.93195384659243,
                         -18.9,	-0.938419155690379,
                         -19,	-0.9448938792788,
                         -19.1,	-0.951378024497099,
                         -19.2,	-0.957871598484689,
                         -19.3,	-0.964374608380978,
                         -19.4,	-0.970887061325375,
                         -19.5,	-0.977408964457291,
                         -19.6,	-0.983940324916133,
                         -19.7,	-0.990481149841314,
                         -19.8,	-0.997031446372241,
                         -19.9,	-1.00359122164832,
                         -20,	-1.01016048280897,
                         -20.1,	-1.0167392369936,
                         -20.2,	-1.02332749134161,
                         -20.3,	-1.02992525299241,
                         -20.4,	-1.03653252908542,
                         -20.5,	-1.04314932676004,
                         -20.6,	-1.04977565315568,
                         -20.7,	-1.05641151541176,
                         -20.8,	-1.06305692066768,
                         -20.9,	-1.06971187606285
                        };
    const int mapSize = sizeof(map) / sizeof(map[0]);
    int range = -1;
    for (int i = 0; i < mapSize - 2; i += 2) {
        if (dz >= map[i + 2] && dz < map[i]) {
            range = i;
            break;
        }
    }
    if (range == -1)
        return 1000;
    float rangeSpan = map[range] - map[range + 2];
    float dist = (dz - map[range + 2]) / rangeSpan;
    float valueSpan = map[range + 1] - map[range + 3];
    return map[range + 3] + valueSpan * dist;
}

void Automator::checkWorkingState()
{
    bool working = m_lastdzValid && m_mcConnected && m_lastCoordsValid && m_enabled && m_cameraConnected;
    if (working) {
        m_working = true;
        m_state = m_cutModeEnabled ? AutoCutting : AutoEngraving;
        emit stateChanged(m_state);
    } else {
        m_working = false;
        m_state = Disabled;
        emit stateChanged(m_state);
    }
}

void Automator::m_scanSnapshot()
{
    float compensated = compensate(m_lastdz);
    if (compensated > 10) {
        m_message = "No entry in comp table";
        emit messageChanged();
        //emit continueScan();
    } else {
        SurfacePoint point;
        point.x = m_mcs_x-605;
        point.y = m_mcs_y;
        point.z = compensated;
        m_surfaceModel->addPoint(point);
        m_message = QString("Z: %1").arg(compensated);
        emit messageChanged();
        qDebug() << m_message;

        SPLINTER::DenseVector x(2);
        float y;

        x(0) = m_mcs_x-605;
        x(1) = m_mcs_y;
        y = compensated;

        m_samples.addSample(x,y);

        emit continueScan();
    }
}

float Automator::minPower() const
{
    return m_minPower;
}

void Automator::setMinPower(float minPower)
{
    m_minPower = minPower;
}

float Automator::lastSentPower() const
{
    return m_lastSentPower;
}

void Automator::scanSurface(int width, int height, int step)
{
    m_scanWidth = width;
    m_scanHeight = height;

    QFile scanGCode("scanGCode.ngc");
    if (scanGCode.open(QFile::WriteOnly | QFile::Truncate)) {
        QTextStream out(&scanGCode);

        out << "M220 S100\nM204 S600\nG90 G0 X0 Y0 F15000\n";

        for (int i=0; i<=height/step; i++)
        {
            out << QString("G0 Y%1\nM25\n").arg(step*i);

            for (int j=1; j<=width/step; j++)
                if (i%2)
                    out << QString("G0 X%1\nM25\n").arg(width-step*j);
                else
                    out << QString("G0 X%1\nM25\n").arg(step*j);
        }

        out << "G0 X0 Y0";
    }

    emit startScan(QUrl("file:scanGCode.ngc"));

    m_state = Scanning;
    emit stateChanged(m_state);
}

void Automator::approveScan()
{
    m_scanComplited = false;
    emit scanStateChanged();

    //todo
}

SurfaceModel *Automator::surfaceModel() const
{
    return m_surfaceModel;
}

void Automator::clearSurface() const
{
    m_surfaceModel->removeAll();
}

Automator::State Automator::state() const
{
    return m_state;
}

float Automator::maxPower() const
{
    return m_maxPower;
}

void Automator::setMaxPower(float maxPower)
{
    m_maxPower = maxPower;
}

bool Automator::autosendPower() const
{
    return m_autosendPower;
}

void Automator::setAutosendPower(bool autosendPower)
{
    m_autosendPower = autosendPower;
}

bool Automator::cutModeEnabled() const
{
    return m_cutModeEnabled;
}

void Automator::setCutModeEnabled(bool cutMode)
{
    m_cutModeEnabled = cutMode;
}

bool Automator::scanComplited() const
{
    return m_scanComplited;
}

bool Automator::enabled() const
{
    return m_enabled;
}

void Automator::setEnabled(bool enabled)
{
    m_enabled = enabled;
    emit enabledChanged();
    checkWorkingState();
}

QString Automator::message() const
{
    return m_message;
}
